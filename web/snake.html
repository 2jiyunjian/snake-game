<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>贪吃蛇网页版</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial,
        "Noto Sans", "Microsoft YaHei", sans-serif;
      background: radial-gradient(circle at top, #1f2933, #020617);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
    }

    .container {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
      padding: 24px 28px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    .title {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-badge {
      width: 12px;
      height: 12px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #22c55e, #15803d);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    .controls {
      font-size: 13px;
      color: #9ca3af;
      display: flex;
      flex-direction: column;
      gap: 4px;
      text-align: right;
    }

    .controls span {
      white-space: nowrap;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 11px;
      color: #e5e7eb;
    }

    .pill kbd {
      font-family: inherit;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 4px;
      padding: 1px 4px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      font-size: 10px;
    }

    .status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .score {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .score-label {
      font-size: 12px;
      color: #9ca3af;
    }

    .score-value {
      font-weight: 600;
      color: #22c55e;
      min-width: 30px;
    }

    .status-text {
      font-size: 12px;
      color: #9ca3af;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      margin-right: 4px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.9);
      display: inline-block;
    }

    .status-dot.paused {
      background: #f97316;
      box-shadow: 0 0 8px rgba(249, 115, 22, 0.9);
    }

    .status-dot.over {
      background: #ef4444;
      box-shadow: 0 0 8px rgba(239, 68, 68, 0.9);
    }

    .canvas-wrapper {
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at top, #020617, #020617);
    }

    canvas {
      display: block;
      background: radial-gradient(circle at top, #020617, #020617);
    }

    .overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 10px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.86), rgba(15, 23, 42, 0.96));
      color: #e5e7eb;
      text-align: center;
    }

    .overlay.hidden {
      display: none;
    }

    .overlay-title {
      font-size: 26px;
      font-weight: 600;
      letter-spacing: 0.08em;
    }

    .overlay-score {
      font-size: 18px;
      color: #9ca3af;
    }

    .overlay-score span {
      color: #22c55e;
      font-weight: 600;
      margin-left: 4px;
    }

    .overlay-tip {
      font-size: 13px;
      color: #9ca3af;
    }

    .overlay-tip kbd {
      font-family: inherit;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 4px;
      padding: 2px 6px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      font-size: 12px;
      color: #e5e7eb;
    }

    @media (max-width: 720px) {
      body {
        padding: 12px;
      }

      .container {
        width: 100%;
        padding: 16px;
      }

      canvas {
        width: 100%;
        height: auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">
        <span class="title-badge"></span>
        贪吃蛇 · Web
      </div>
      <div class="controls">
        <span>
          <span class="pill">
            移动
            <kbd>↑</kbd>
            <kbd>↓</kbd>
            <kbd>←</kbd>
            <kbd>→</kbd>
          </span>
        </span>
        <span>
          <span class="pill">
            暂停/开始
            <kbd>Space</kbd>
          </span>
        </span>
      </div>
    </div>

    <div class="status-bar">
      <div class="score">
        <span class="score-label">当前分数</span>
        <span class="score-value" id="score">0</span>
      </div>
      <div class="status-text" id="statusText">
        <span class="status-dot"></span>
        游戏进行中
      </div>
    </div>

    <div class="canvas-wrapper">
      <canvas id="gameCanvas" width="600" height="600"></canvas>
      <div class="overlay" id="overlay">
        <div class="overlay-title" id="overlayTitle">按空格开始游戏</div>
        <div class="overlay-score" id="overlayScore" style="display:none;">
          最终得分：
          <span id="finalScore">0</span>
        </div>
        <div class="overlay-tip">
          <div>方向键控制移动</div>
          <div style="margin-top: 4px;">
            <kbd>Space</kbd>
            开始 / 暂停 / 再来一局
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 基本参数
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const statusTextEl = document.getElementById("statusText");
    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlayScore = document.getElementById("overlayScore");
    const finalScoreEl = document.getElementById("finalScore");

    const BOARD_SIZE = 600;
    const UNIT = 25;
    const ROWS = BOARD_SIZE / UNIT;
    const COLS = BOARD_SIZE / UNIT;
    const INITIAL_LENGTH = 3;
    const TICK_MS = 100;

    const DIR = {
      LEFT: { x: -1, y: 0 },
      RIGHT: { x: 1, y: 0 },
      UP: { x: 0, y: -1 },
      DOWN: { x: 0, y: 1 },
    };

    let snake = [];
    let direction = DIR.RIGHT;
    let nextDirection = DIR.RIGHT;
    let food = null;
    let running = false;
    let paused = false;
    let gameOver = false;
    let score = 0;
    let lastTick = 0;

    // 初始化游戏
    function initGame() {
      snake = [];
      const startX = Math.floor(COLS / 2);
      const startY = Math.floor(ROWS / 2);
      for (let i = 0; i < INITIAL_LENGTH; i++) {
        snake.push({ x: startX - i, y: startY });
      }
      direction = DIR.RIGHT;
      nextDirection = DIR.RIGHT;
      score = 0;
      running = false;
      paused = false;
      gameOver = false;
      lastTick = 0;

      scoreEl.textContent = score;
      setStatus("ready");
      spawnFood();
      draw();

      overlay.classList.remove("hidden");
      overlayTitle.textContent = "按空格开始游戏";
      overlayScore.style.display = "none";
    }

    function setStatus(state) {
      const dot = statusTextEl.querySelector(".status-dot");
      if (state === "running") {
        dot.classList.remove("paused", "over");
        statusTextEl.innerHTML = '<span class="status-dot"></span>游戏进行中';
      } else if (state === "paused") {
        statusTextEl.innerHTML = '<span class="status-dot paused"></span>已暂停';
      } else if (state === "over") {
        statusTextEl.innerHTML = '<span class="status-dot over"></span>游戏结束';
      } else {
        statusTextEl.innerHTML = '<span class="status-dot paused"></span>就绪';
      }
    }

    function spawnFood() {
      while (true) {
        const x = Math.floor(Math.random() * COLS);
        const y = Math.floor(Math.random() * ROWS);
        const conflict = snake.some((segment) => segment.x === x && segment.y === y);
        if (!conflict) {
          food = { x, y };
          break;
        }
      }
    }

    function gameLoop(timestamp) {
      if (!running || paused || gameOver) {
        requestAnimationFrame(gameLoop);
        return;
      }

      if (timestamp - lastTick >= TICK_MS) {
        lastTick = timestamp;
        step();
        draw();
      }
      requestAnimationFrame(gameLoop);
    }

    function step() {
      // 更新方向（防止同时反向）
      direction = nextDirection;

      const head = snake[0];
      const newHead = {
        x: head.x + direction.x,
        y: head.y + direction.y,
      };

      // 撞墙
      if (
        newHead.x < 0 ||
        newHead.x >= COLS ||
        newHead.y < 0 ||
        newHead.y >= ROWS
      ) {
        handleGameOver();
        return;
      }

      // 撞到自己
      if (snake.some((segment) => segment.x === newHead.x && segment.y === newHead.y)) {
        handleGameOver();
        return;
      }

      // 移动
      snake.unshift(newHead);

      // 是否吃到食物
      if (food && newHead.x === food.x && newHead.y === food.y) {
        score++;
        scoreEl.textContent = score;
        spawnFood();
      } else {
        snake.pop();
      }
    }

    function handleGameOver() {
      running = false;
      gameOver = true;
      setStatus("over");
      overlay.classList.remove("hidden");
      overlayTitle.textContent = "游戏结束";
      overlayScore.style.display = "block";
      finalScoreEl.textContent = score;
    }

    function drawGrid() {
      ctx.save();
      ctx.strokeStyle = "rgba(31, 41, 55, 0.8)";
      ctx.lineWidth = 1;

      for (let i = 0; i <= COLS; i++) {
        ctx.beginPath();
        ctx.moveTo(i * UNIT + 0.5, 0);
        ctx.lineTo(i * UNIT + 0.5, BOARD_SIZE);
        ctx.stroke();
      }

      for (let j = 0; j <= ROWS; j++) {
        ctx.beginPath();
        ctx.moveTo(0, j * UNIT + 0.5);
        ctx.lineTo(BOARD_SIZE, j * UNIT + 0.5);
        ctx.stroke();
      }

      ctx.restore();
    }

    function draw() {
      // 背景
      ctx.fillStyle = "#020617";
      ctx.fillRect(0, 0, BOARD_SIZE, BOARD_SIZE);

      // 网格
      drawGrid();

      // 食物
      if (food) {
        const x = food.x * UNIT;
        const y = food.y * UNIT;
        const radius = UNIT / 2 - 2;
        const centerX = x + UNIT / 2;
        const centerY = y + UNIT / 2;

        const gradient = ctx.createRadialGradient(
          centerX - 4,
          centerY - 4,
          2,
          centerX,
          centerY,
          radius
        );
        gradient.addColorStop(0, "#f97316");
        gradient.addColorStop(1, "#b91c1c");

        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.fill();
      }

      // 蛇
      for (let i = 0; i < snake.length; i++) {
        const segment = snake[i];
        const x = segment.x * UNIT;
        const y = segment.y * UNIT;

        if (i === 0) {
          // 头部
          const gradient = ctx.createLinearGradient(x, y, x + UNIT, y + UNIT);
          gradient.addColorStop(0, "#4ade80");
          gradient.addColorStop(1, "#16a34a");
          ctx.fillStyle = gradient;
        } else {
          ctx.fillStyle = "#15803d";
        }

        ctx.fillRect(x + 1, y + 1, UNIT - 2, UNIT - 2);

        // 头部的眼睛
        if (i === 0) {
          ctx.fillStyle = "#022c22";
          const eyeSize = 3;
          let eye1x, eye1y, eye2x, eye2y;

          if (direction === DIR.RIGHT) {
            eye1x = x + UNIT - 6;
            eye1y = y + 6;
            eye2x = x + UNIT - 6;
            eye2y = y + UNIT - 8;
          } else if (direction === DIR.LEFT) {
            eye1x = x + 4;
            eye1y = y + 6;
            eye2x = x + 4;
            eye2y = y + UNIT - 8;
          } else if (direction === DIR.UP) {
            eye1x = x + 6;
            eye1y = y + 4;
            eye2x = x + UNIT - 10;
            eye2y = y + 4;
          } else {
            // DOWN
            eye1x = x + 6;
            eye1y = y + UNIT - 8;
            eye2x = x + UNIT - 10;
            eye2y = y + UNIT - 8;
          }

          ctx.fillRect(eye1x, eye1y, eyeSize, eyeSize);
          ctx.fillRect(eye2x, eye2y, eyeSize, eyeSize);
        }
      }
    }

    // 键盘控制
    window.addEventListener("keydown", (e) => {
      const key = e.key;

      if (key === " " || key === "Spacebar") {
        e.preventDefault();
        // 空格：开始/暂停/重新开始
        if (!running && !gameOver) {
          // 就绪 -> 开始
          running = true;
          paused = false;
          overlay.classList.add("hidden");
          setStatus("running");
        } else if (running && !gameOver) {
          // 正在运行 -> 暂停
          paused = !paused;
          if (paused) {
            setStatus("paused");
            overlay.classList.remove("hidden");
            overlayTitle.textContent = "已暂停";
            overlayScore.style.display = "none";
          } else {
            overlay.classList.add("hidden");
            setStatus("running");
          }
        } else if (gameOver) {
          // 结束 -> 再来一局
          initGame();
        }
        return;
      }

      if (!running || paused || gameOver) {
        return;
      }

      // 方向键
      if (key === "ArrowUp" && direction !== DIR.DOWN) {
        nextDirection = DIR.UP;
      } else if (key === "ArrowDown" && direction !== DIR.UP) {
        nextDirection = DIR.DOWN;
      } else if (key === "ArrowLeft" && direction !== DIR.RIGHT) {
        nextDirection = DIR.LEFT;
      } else if (key === "ArrowRight" && direction !== DIR.LEFT) {
        nextDirection = DIR.RIGHT;
      }
    });

    // 启动
    initGame();
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>

